<% if @profile %>
  
  <div class="box">
    <h3>Edit Profile</h3>

    <form action="/update" method="POST">
      <fieldset>
        <div class="form-group">
          <!--<label for="trainee[about]">About</label>
          <input type="text" name="trainee[about]" value="<%= @profile["about"] %>"/>-->
        
          <div id="details" class="profile-section">
     <% ["first_name","twitter","last_name","homepage","dob","github","gender","employment_status","phone_number","codecademy"].each do |field| %>
       <div class="profile-section-<%= @a =  @a == "left" ? "right" : "left"  %> box">
         <h4><%= field.split("_").map{|b| b.capitalize}.join(" ")  %></h4>
         <input type="text" name="trainee[<%=field%>]" id="details" class="profile-value" value="<%= @profile[field] %>" />
       </div>
     <%end%>    
   </div>

  

   <div id="trainee" class="profile-section">
     <% ["about","ambition","projects","learning_experience","rationale"].each do |field| %>
        <div class="profile-section-left box">
          <h4><%= field.split("_").map{|b| b.capitalize}.join(" ")  %></h4>
          <textarea rows=10 cols=60 name="trainee[<%=field%>]" class="profile-value trainee"><%= @profile[field] %> </textarea>
        </div>   
     <%end%>    
  </div>




        </div>

        <!-- TODO - Add more fields Disso that your profile can be edited -->
        <input id="cancel" onclick="DiscardChanges()" type="button" value="Cancel" class="btn btn-primary"/>
        <input id="submit" onclick="CheckTextAreaLenght()" type="submit" value="Update" class="btn btn-primary" />
      </fieldset>
    </form>
  </div>
<% else %>
  <div class="welcome">
    <p>Welcome! Once you have updated the OAuth tokens, the link below will fetch your profile information.</p>

    <a href="/authorise">Authorise</a>
  </div>
<% end %>


<!-- Add your Javascript to this script tag -->
<script language="javascript">


  var CountWords = function(text)
  {
    text=text.replace(/\W+/g,' ').trim();
    if ( text === "" ) {
      return 0;
    } else {
      return text.replace(/\W+/g,' ').trim().split(' ').length;
    } 
  }
  
  function DiscardChanges () {
    console.log("I am Javascript!");
    var r = confirm("Discard changes?");
    if ( r === true) {
      window.location.href ='/';
    } else {
     return false;
    }
  }

  function CheckTextAreaLenght() {
    var profile_values = document.getElementsByTagName('textarea');
    
    console.log("Dentro");
    for ( var i=0; i < profile_values.length; i += 1 ) {
      
      var this_item = CountWords(profile_values.item(i).value);
      console.log("Aqui " + this_item);
      profile_values.item(i).className =  profile_values.item(i).className.replace(/ invalid/,'');
      console.log("Hola " + profile_values.item(i).className);
      if ( this_item < 20) {
        
        profile_values.item(i).className += " invalid";
        profile_values.item(i).focus();
        confirm("You need to write at leas 20 words");
        event.returnValue=false;
        return false;     
      }
    }
  }


</script>